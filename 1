#!/bin/bash

# Определите интерфейс (например, eth0 или ens33). 
# Можно дать пользователю выбор:
read -p "Введите имя сетевого интерфейса (например, eth0): " IFACE

# Проверка существования интерфейса
if ! ip link show "$IFACE" &>/dev/null; then
    echo "Интерфейс $IFACE не найден!"
    exit 1
fi

while true; do
    echo "--------------------------------------"
    echo " Меню управления сетью ($IFACE)"
    echo "--------------------------------------"
    echo "1) Информация о сетевой карте"
    echo "2) Информация о текущей IPv4 конфигурации"
    echo "3) Настроить статическую конфигурацию (сценарий 1)"
    echo "4) Настроить динамическую конфигурацию (сценарий 2)"
    echo "5) Выход"
    echo "--------------------------------------"
    read -p "Выберите пункт меню: " choice

    case $choice in
        1)
            echo ">>> Информация о сетевой карте:"
            ethtool "$IFACE" 2>/dev/null | grep -E "Speed|Duplex|Link detected"
            MAC=$(cat /sys/class/net/$IFACE/address)
            MODEL=$(ethtool -i "$IFACE" 2>/dev/null | grep "driver" | awk '{print $2}')
            echo "MAC-адрес: $MAC"
            echo "Драйвер: $MODEL"
            ;;
        2)
            echo ">>> Текущая IPv4 конфигурация:"
            ip -4 addr show dev "$IFACE" | grep inet
            ip route show default 2>/dev/null | grep "$IFACE"
            echo "DNS-серверы:"
            resolvectl dns "$IFACE" 2>/dev/null || cat /etc/resolv.conf | grep nameserver
            ;;
        3)
            echo ">>> Настройка статической конфигурации..."
            sudo ip addr flush dev "$IFACE"
            sudo ip addr add 10.100.0.2/24 dev "$IFACE"
            sudo ip link set "$IFACE" up
            sudo ip route add default via 10.100.0.1
            sudo resolvectl dns "$IFACE" 8.8.8.8 2>/dev/null || echo "nameserver 8.8.8.8"
            echo "Статическая конфигурация применена."
            ;;
        4)
            echo ">>> Настройка DHCP..."
            sudo ip addr flush dev "$IFACE"
            sudo dhclient -r "$IFACE" 2>/dev/null
            sudo dhclient "$IFACE"
            echo "Динамическая конфигурация применена."
            ;;
        5)
            echo "Выход."
            exit 0
            ;;
        *)
            echo "Неверный выбор!"
            ;;
    esac
done
